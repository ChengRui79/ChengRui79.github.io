<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="author" content="CR"><meta name="keywords" content="CR,博客,技术,划水,无聊,JAVA,Python,Docker"><meta name="description" content="Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的镜像中，然后发布到任何流行的 Linux或Windows操作系统的机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口"><meta property="og:type" content="article"><meta property="og:title" content="docker"><meta property="og:url" content="https://zcsry.cn/2023/05/07/Docker/index.html"><meta property="og:site_name" content="One computer paddler&#39;s blog"><meta property="og:description" content="Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的镜像中，然后发布到任何流行的 Linux或Windows操作系统的机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://zcsry.cn/img/index/docker.jpg"><meta property="article:published_time" content="2023-05-07T00:40:51.000Z"><meta property="article:modified_time" content="2023-05-07T12:26:42.022Z"><meta property="article:author" content="CR"><meta property="article:tag" content="docker"><meta property="article:tag" content="AT"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://zcsry.cn/img/index/docker.jpg"><title>docker - One computer paddler&#39;s blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"zcsry.cn",root:"/",version:"1.9.4",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"NZzmWHo4vLeDsTh3MaGJBfT1-gzGzoHsz",app_key:"EaF7VkHeBkgVwTLy7IHYmPIs",server_url:"https://nzzmwho4.lc-cn-n1-shared.com",path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=+new Date,a=t.createElement(o),n=t.getElementsByTagName(o)[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,"script",("https:"===document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/54e451b4.js","daovoice"),daovoice("init",{app_id:"54e451b4"}),daovoice("update")</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="One computer paddler's blog" type="application/atom+xml"></head><body><header><div class="header-inner" style="height:70"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>CR</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item"><a class="nav-link" href="https://zcsry.cn/atom.xml"><i class="iconfont icon-rss"></i> <span>RSS</span></a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> <span>友链</span></a></li><li class="nav-item"><a class="nav-link" href="/shuoshuo/"><i class="iconfont icon-pen"></i> <span>说说</span></a></li><li class="nav-item"><a class="nav-link" href="/todolist/"><i class="iconfont icon-clipcheck"></i> <span>todolist</span></a></li><li class="nav-item"><a class="nav-link" href="/note/"><i class="iconfont icon-notebook"></i> <span>日志</span></a></li><li class="nav-item"><a class="nav-link" href="/video/"><i class="iconfont icon-bilibili"></i> <span>video</span></a></li><li class="nav-item"><a class="nav-link" href="/musics/"><i class="iconfont icon-music"></i> <span>musics</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="docker"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-05-07 08:40" pubdate>2023年5月7日 早上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 10k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 87 分钟 </span><span id="leancloud-page-views-container" class="post-meta" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="leancloud-page-views"></span> 次</span></div></div></div></div></div></div><div class="weather">{% if theme.xinzhi_weather %}<div id="tp-weather-widget"></div><script>!function(e,t,n,a,o,i,c,d){d=function(){i=t.createElement(n),c=t.getElementsByTagName(n)[0],i.src=o,i.charset="utf-8",i.async=1,c.parentNode.insertBefore(i,c)},e.SeniverseWeatherWidgetObject=a,e[a]||(e[a]=function(){(e[a].q=e[a].q||[]).push(arguments)}),e[a].l=+new Date,e.attachEvent?e.attachEvent("onload",d):e.addEventListener("load",d,!1)}(window,document,"script","SeniverseWeatherWidget","//cdn.sencdn.com/widget2/static/js/bundle.js?t="+parseInt(((new Date).getTime()/1e8).toString(),10)),window.SeniverseWeatherWidget("show",{flavor:"slim",location:"WX4FBXXFKE4F",geolocation:!0,language:"auto",unit:"c",theme:"auto",token:"ee045b49-c5c0-4d5a-ba5d-a13fe06dd99a",hover:"enabled",container:"tp-weather-widget"})</script></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">docker</h1><div class="markdown-body"><h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h2 id="一、认识docker"><a href="#一、认识docker" class="headerlink" title="一、认识docker"></a>一、认识docker</h2><ul><li>Docker是一个开源的应用容器引擎</li><li>Docker让开发者可以打包他们的应用以及依赖包到一个轻量级可移植的容器中然后发布到任何流行的 Linux或Windows操作系统的机器上</li><li>容器是完全使用沙箱机制，相互之间不会有任何接口，相互隔离</li></ul><h2 id="二、Docker架构"><a href="#二、Docker架构" class="headerlink" title="二、Docker架构"></a>二、Docker架构</h2><p>Docker使用C&#x2F;S架构,<strong>Client 通过接口与Server进程通信实现容器的构建，运行和发布</strong>.client<br>和server可以运行在同一台集群，也可以通过跨主机实现远程通信。</p><p><img src="https://gcore.jsdelivr.net/gh/ChengRui79/ImageHost@main/img/202305071545985.png" srcset="/img/loading.gif" lazyload alt="image-20230507092144273"></p><p>Docker技术的三大核心概念，分别是：</p><ul><li>镜像（Image）</li><li>容器（Container）</li><li>仓库（Repostitory）</li></ul><h3 id="Docker镜像（Image）"><a href="#Docker镜像（Image）" class="headerlink" title="Docker镜像（Image）"></a>Docker镜像（Image）</h3><p>Docker 镜像（Image）就是一个只读的模板。例如：一个镜像可以包含一个完整的操作系统<br>环境，里面仅安装了 Apache 或用户需要的其它应用程序</p><ul><li><p>镜像可以用来创建 Docker 容器，一个镜像可以创建很多容器。Docker 提供了一个很简单的<br>机制来创建镜像或者更新现有的镜像，用户甚至可以直接从其他人那里下载一个已经做好的镜<br>像来直接使用。</p></li><li><p>镜像（Image）就是一堆只读层（read-only layer）的统一视角</p></li></ul><h3 id="Docker容器（Container）"><a href="#Docker容器（Container）" class="headerlink" title="Docker容器（Container）"></a>Docker容器（Container）</h3><p>Docker 利用容器（Container）来运行应用。容器是从镜像创建的运行实例。它可以被启动、开始、停止、删除。每个容器都是相互隔离的、保证安全的平台。我们可以把Image和Container的关系类比于面向对象中的类和对象的关系。</p><ul><li>可以把容器看做是一个简易版的 Linux 环境（包括root用户权限、进程空间、用户空间和网络空间等）和运行在其中的应用程序。</li><li>创建Container首先要有Image，也就是说Container是通过image创建的。<br>Container是在原先的Image之上新加的一层，称作Container layer，这一层是可读可写的（Image是只读的）。<br>在面向对象的编程语言中，有类跟对象的概念。类是抽象的，对象是类的具体实现。Image跟Container可以类比面向对象中的类跟对象，Image就相当于抽象的类，Container就相当于具体实例化的对象。<br>Image跟Container的职责区别：Image负责APP的存储和分发，Container负责运行APP</li></ul><h3 id="Docker仓库（Repostitory）"><a href="#Docker仓库（Repostitory）" class="headerlink" title="Docker仓库（Repostitory）"></a>Docker仓库（Repostitory）</h3><p>仓库（Repository）是集中存放<strong>镜像文件</strong>的场所。有时候会把仓库和仓库注册服务(Registry)混为一谈，并不严格区分。</p><p>实际上，仓库注册服务器上往往存放着多个仓库，每个仓库中又包含了多个镜像，每个镜像有不同的标签（tag）。<br>仓库分为<strong>公开仓库（Public）和私有仓库（Private）</strong>两种形式。</p><p>最大的公开仓库是 Docker Hub（<a target="_blank" rel="noopener" href="https://hub.docker.com/)%EF%BC%8C%E5%AD%98%E6%94%BE%E4%BA%86%E6%95%B0%E9%87%8F%E5%BA%9E%E5%A4%A7%E7%9A%84%E9%95%9C%E5%83%8F%E4%BE%9B%E7%94%A8%E6%88%B7%E4%B8%8B%E8%BD%BD%E3%80%82">https://hub.docker.com/)，存放了数量庞大的镜像供用户下载。</a><br>国内的公开仓库包括 阿里云 、网易云 等，可以提供大陆用户更稳定快速的访问。<br>当然，用户也可以在本地网络内创建一个私有仓库。<br>当用户创建了自己的镜像之后就可以使用 push 命令将它上传到公有或者私有仓库，这样下次在另外一台机器上使用这个镜像时候，只需要从仓库上 pull 下来就可以了。<br>Docker 仓库的概念跟 Git 类似，注册服务器可以理解为 GitHub 这样的托管服务。</p><h2 id="三、安装Docker"><a href="#三、安装Docker" class="headerlink" title="三、安装Docker"></a>三、安装Docker</h2><p>1.更新yum包</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">yum update</span><br></code></pre></td></tr></table></figure><p>2.安装yum工具包和存储驱动</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-title">yum</span> install -y yum-utils device-mapper-persistent-<span class="hljs-class"><span class="hljs-keyword">data</span> lvm2</span><br></code></pre></td></tr></table></figure><p>3.安装Docker的yum源</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">yum-config-manager --add-repo https:<span class="hljs-regexp">//</span>download.docker.com<span class="hljs-regexp">/linux/</span>centos/docker-ce.rep<br>如果连接超时，可以使用alibaba源<br>yum-config-manager --add-repo http:<span class="hljs-regexp">//mi</span>rrors.aliyun.com<span class="hljs-regexp">/docker-ce/</span>linux<span class="hljs-regexp">/centos/</span>docker-ce.rep<br></code></pre></td></tr></table></figure><p>4.安装Docker</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> -y docker-ce<br></code></pre></td></tr></table></figure><p>5.查看Docker版本，验证是否安装成功</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker -v</span><br></code></pre></td></tr></table></figure><h2 id="三、Docker常用命令"><a href="#三、Docker常用命令" class="headerlink" title="三、Docker常用命令"></a>三、Docker常用命令</h2><h3 id="Docker进程相关"><a href="#Docker进程相关" class="headerlink" title="Docker进程相关"></a>Docker进程相关</h3><h4 id="启动Docker"><a href="#启动Docker" class="headerlink" title="启动Docker"></a>启动Docker</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">sudo service docker <span class="hljs-literal">start</span><br></code></pre></td></tr></table></figure><h4 id="设置开机启动"><a href="#设置开机启动" class="headerlink" title="设置开机启动"></a>设置开机启动</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">systemctl <span class="hljs-built_in">enable</span> docker<br></code></pre></td></tr></table></figure><h4 id="查看Docker状态"><a href="#查看Docker状态" class="headerlink" title="查看Docker状态"></a>查看Docker状态</h4><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">systemctl status docker</span><br></code></pre></td></tr></table></figure><h4 id="Docker-启动和停止"><a href="#Docker-启动和停止" class="headerlink" title="Docker 启动和停止"></a>Docker 启动和停止</h4><img src="https://gcore.jsdelivr.net/gh/ChengRui79/ImageHost@main/img/202305070951625.png" srcset="/img/loading.gif" lazyload alt="image-20230507095109572" style="zoom:80%"><h3 id="Docker镜像相关"><a href="#Docker镜像相关" class="headerlink" title="Docker镜像相关"></a>Docker镜像相关</h3><h4 id="查看镜像"><a href="#查看镜像" class="headerlink" title="查看镜像"></a>查看镜像</h4><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker images</span><br></code></pre></td></tr></table></figure><p>REPOSITORY：镜像名称<br>TAG：镜像标签<br>IMAGE ID：镜像id<br>CREATED：镜像的创建日期（不是获取该镜像的日期）<br>SIZE：镜像大小</p><h4 id="搜索镜像"><a href="#搜索镜像" class="headerlink" title="搜索镜像"></a>搜索镜像</h4><p>网站：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com</a></p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs excel">docker <span class="hljs-built_in">search</span> 某个XXX镜像名字<br></code></pre></td></tr></table></figure><p>NAME：镜像名称<br>DESCRIPTION：镜像描述<br>STARS：用户评价，反应一个镜像的受欢迎程度<br>OFFICIAL：是否官方<br>AUTOMATED：自动构建，表示该镜像由Docker Hub自动构建流程创建的</p><h4 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h4><ul><li>拉取镜像就是从中央仓库中下载镜像到本地，命令：</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">docker</span> pull 镜像名字<br></code></pre></td></tr></table></figure><p>拉取镜像的时候默认拉取<strong>最新的版本</strong>，如果想拉取指定版本的话，需要添加版本号信息，不指<br>定版本的话拉取的是latest这个版本的镜像。<br>拉取指定版本的时候追加版本信息（网站：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com</a>查找）：docker pull centos:7</p><h4 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h4><ul><li><p>删除单个镜像</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">docker</span> <span class="hljs-variable">rmi</span> -<span class="hljs-variable">f</span> 镜像<span class="hljs-function"><span class="hljs-title">ID</span>(<span class="hljs-variable">IMAGE</span> <span class="hljs-variable">ID</span>)</span><br></code></pre></td></tr></table></figure></li><li><p>删除多个镜像</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">docker rmi -f 镜像名<span class="hljs-number">1</span>:<span class="hljs-keyword">TAG</span> <span class="hljs-title">镜像名2</span>:<span class="hljs-keyword">TAG</span><br></code></pre></td></tr></table></figure></li><li><p>删除全部</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">docker</span> rmi -f  <span class="hljs-string">&#x27;docker images -qa&#x27;</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="Docker容器相关"><a href="#Docker容器相关" class="headerlink" title="Docker容器相关"></a>Docker容器相关</h3><h4 id="查看容器"><a href="#查看容器" class="headerlink" title="查看容器"></a>查看容器</h4><ul><li>查看正在运行的容器</li></ul><blockquote><p>docker ps</p></blockquote><ul><li>查看所有容器</li></ul><blockquote><p>docker ps -a</p></blockquote><ul><li>查看最后一次运行的容器</li></ul><blockquote><p>docker ps -l</p></blockquote><ul><li>查看停止的容器</li></ul><blockquote><p>docker ps -f status&#x3D;exited</p></blockquote><h4 id="创建与启动容器"><a href="#创建与启动容器" class="headerlink" title="创建与启动容器"></a>创建与启动容器</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">docker <span class="hljs-built_in">run</span><br></code></pre></td></tr></table></figure><ul><li><p>OPTIONS说明（常用）：有些是一个减号，有些是两个减号</p><p>–name&#x3D;“容器新名字”: 为容器指定一个名称；<br>-d: 在run后面加上参数-d，会创建一个守护式容器在后台运行（这样创建容器后不会自动登录容器，如果只加-i-t两个参数，<br>创建后会自动进入容器），并返回容器ID，也即启动守护式容器；<br>-i：以交互模式运行容器，通常与 -t 同时使用；<br>-t：表示容器启动后会进入其命令行，为容器重新分配一个伪输入终端，通常与 -i 同时使用；<br>-p: 表示端口映射，有以下四种格式<br>ip:hostPort:containerPort<br>ip::containerPort<br>hostPort:containerPort<br>containerPort<br>前者表示宿主机端口，后者是容器内的映射端口，可以使用多个-p做多个端口映射</p></li><li><p>启动交互式容器</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker run -it --name=centos 镜像名称:标签 <span class="hljs-regexp">/bin/</span>bash<br><span class="hljs-keyword">exit</span> 退出容器<br>拉取centos：docker pull centos<br>docker run -id centos <span class="hljs-regexp">/bin/</span>bash 后台运行（不会直接进入容器，进入容器之后<span class="hljs-keyword">exit</span>不会关闭容器）<br>docker exec -it name <span class="hljs-regexp">/bin/</span>bash 进入容器<br></code></pre></td></tr></table></figure></li><li><p>守护式方式创建容器</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker run -id --name=容器名称 镜像名称:标签后台运行（不会直接进入容器，进入容器之后<span class="hljs-keyword">exit</span>不会关闭容器）<br>docker run -id --name=mycentos2 centos:latest<br>docker exec -it name <span class="hljs-regexp">/bin/</span>bash 进入容器<br></code></pre></td></tr></table></figure></li></ul><blockquote><p>&#x2F;bin&#x2F;bash的作用是因为docker后台必须运行一个进程，否则容器就会退出，在这里表示启动容<br>器后启动bash。</p></blockquote><p><strong>什么是守护式容器：</strong></p><blockquote><p>能够长期运行、没有交互式会话、适合运行应用程序和服务</p></blockquote><ul><li>退出当前容器</li></ul><blockquote><p>exit</p></blockquote><h4 id="停止与启动容器"><a href="#停止与启动容器" class="headerlink" title="停止与启动容器"></a>停止与启动容器</h4><ul><li>停止容器</li></ul><blockquote><p>docker stop 容器名称（或者容器id）<br>docker stop mycentos2</p></blockquote><ul><li>启动容器</li></ul><blockquote><p>docker start 容器名称（或者容器id）<br>docker start mycentos2</p></blockquote><ul><li>重启容器</li></ul><blockquote><p>docker restart 容器名称（或者容器id）<br>docker restart mycentos2</p></blockquote><ul><li>强制停止容器</li></ul><blockquote><p>docker kill 容器名称（或者容器id）<br>docker kill mycentos2</p></blockquote><ul><li>删除容器（需先停止容器）</li></ul><blockquote><p>docker rm 容器名称（或者容器id）<br>docker rm mycentos2</p><p>docker rm ‘docker ps -aq’ 通过查询所有容器的id删除所有容器</p></blockquote><ul><li>查看容器信息</li></ul><blockquote><p>docker inspect</p></blockquote><h3 id="配置阿里云镜像加速"><a href="#配置阿里云镜像加速" class="headerlink" title="配置阿里云镜像加速"></a>配置阿里云镜像加速</h3><p>登陆阿里云开发者平台（<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors%EF%BC%89%E8%8E%B7%E5%8F%96%E5%8A%A0%E9%80%9F%E5%99%A8%E5%9C%B0%E5%9D%80">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors）获取加速器地址</a></p><p><img src="https://gcore.jsdelivr.net/gh/ChengRui79/ImageHost@main/img/202305071545732.png" srcset="/img/loading.gif" lazyload alt="image-20230507094221339"></p><h2 id="四、Docker容器的数据卷"><a href="#四、Docker容器的数据卷" class="headerlink" title="四、Docker容器的数据卷"></a>四、Docker容器的数据卷</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>思考：</p><ul><li>Docker容器删除后，在容器中产生的数据会随之销毁</li><li>Docker容器和外部机器不可以直接交换文件</li><li>容器之间数据交换</li></ul><p>数据卷：</p><ul><li>数据卷是宿主机中的一个目录或文件</li><li>当容器目录和数据卷绑定后，对方修改会立即同步</li><li>一个容器可以挂载多个数据卷</li></ul><p>数据卷作用：</p><ul><li>容器数据持久化</li><li>外部机器和容器间接通信</li><li>容器之间数据交换</li></ul><h3 id="配置数据卷"><a href="#配置数据卷" class="headerlink" title="配置数据卷"></a>配置数据卷</h3><p>可以在创建容器的时候，将宿主机的目录和容器内的目录进行映射，这样就可以通过修改宿主机的某个目录的文件从而去影响容器。<br>创建容器添加-v参数，后边为宿主机目录:容器目录，例如：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker run -it -v <span class="hljs-regexp">/root/</span>data<span class="hljs-regexp">/:/</span>root/data --name=c1 centos:<span class="hljs-number">7</span>一个容器挂载一个数据卷<br>docker run -it --name=c2 -v <span class="hljs-regexp">/root/</span>data<span class="hljs-regexp">/:/</span>root<span class="hljs-regexp">/data -v /</span>root<span class="hljs-regexp">/data1/</span>:<span class="hljs-regexp">/root/</span>data1 centos:<span class="hljs-number">7</span> 一个容器挂载多个数据卷<br>docker run -it -v <span class="hljs-regexp">/root/</span>data<span class="hljs-regexp">/:/</span>root/data --name=c3 centos:<span class="hljs-number">7</span><br>docker run -it -v <span class="hljs-regexp">/root/</span>data<span class="hljs-regexp">/:/</span>root/data --name=c4 centos:<span class="hljs-number">7</span> 多个容器挂载同一个数据卷<br></code></pre></td></tr></table></figure><h3 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h3><p>多容器之间数据交换：</p><ol><li>多个容器挂载同一个数据卷</li><li>数据卷容器</li></ol><h3 id="配置数据卷-1"><a href="#配置数据卷-1" class="headerlink" title="配置数据卷"></a>配置数据卷</h3><p>1.创建启动数据卷容器c3，使用-v参数设置数据卷</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> -it -v /volume <span class="hljs-attribute">--name</span>=c3 centos:7 /bin/bash<br></code></pre></td></tr></table></figure><p>2.创建启动容器c1,c2，使用–volumes-from参数设置数据卷</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> -it <span class="hljs-attribute">--name</span>=c1 --volumes-from c3 centos:7 /bin/bash<br>docker <span class="hljs-built_in">run</span> -it <span class="hljs-attribute">--name</span>=c2 --volumes-from c3 centos:7 /bin/bash<br></code></pre></td></tr></table></figure><h2 id="Docker-应用部署"><a href="#Docker-应用部署" class="headerlink" title="Docker 应用部署"></a>Docker 应用部署</h2><h3 id="MySQL-部署"><a href="#MySQL-部署" class="headerlink" title="MySQL 部署"></a>MySQL 部署</h3><img src="https://gcore.jsdelivr.net/gh/ChengRui79/ImageHost@main/img/202305071548873.png" srcset="/img/loading.gif" lazyload alt="image-20230507154827799" style="zoom:67%"><ul><li>Docker hub上查找mysql镜像</li></ul><blockquote><p>docker search mysql</p></blockquote><ul><li>从Docker Hub上(阿里云加速器)拉取mysql镜像到本地,标签为5.6</li></ul><blockquote><p>docker pull mysql:5.6</p></blockquote><ul><li>创建容器,设置端口映射、目录映射</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#在root目录下创建mysql目录用于存储mysql数据信息</span><br><span class="hljs-built_in">mkdir</span> ~/mysql<br><span class="hljs-built_in">cd</span> ~/mysql<br></code></pre></td></tr></table></figure><blockquote><p>docker run -id \</p><p>–name&#x3D;c_mysql \</p><p>-p 3307:3306 \</p><p>-v $PWD&#x2F;conf:&#x2F;etc&#x2F;mysql&#x2F;conf.d \</p><p>-v $PWD&#x2F;logs:&#x2F;logs \</p><p>-v $PWD&#x2F;data:&#x2F;var&#x2F;lib&#x2F;mysql \</p><p>-e MYSQL_ROOT_PASSWORD&#x3D;123456<br>mysql:5.6</p></blockquote><p>-p 代表端口映射，格式为<strong>宿主机映射端口:容器运行端口</strong><br>-e 代表添加环境变量，MYSQL_ROOT_PASSWORD是root用户的登录密码</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker exec -it c_mysql <span class="hljs-regexp">/bin/</span>bash 进入mysql容器<br>mysql -uroot -p123456 进入mysql<br></code></pre></td></tr></table></figure><ul><li><p>使用mysql客户端navicat连接</p><p>注意这里端口已被映射为3307（一般我们映射3306）</p></li></ul><h3 id="tomcat-部署"><a href="#tomcat-部署" class="headerlink" title="tomcat 部署"></a>tomcat 部署</h3><ul><li>Docker hub上查找tomcat镜像</li></ul><blockquote><p>docker search tomcat</p></blockquote><ul><li>从Docker Hub上(阿里云加速器)拉取tomcat镜像</li></ul><blockquote><p>docker pull tomcat</p></blockquote><ul><li>创建容器,设置端口映射、目录映射</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#在root目录下创建tomcat目录用于存储tomcat数据信息</span><br><span class="hljs-built_in">mkdir</span> ~/tomcat<br><span class="hljs-built_in">cd</span> ~/tomcat<br></code></pre></td></tr></table></figure><blockquote><p>docker run -id \</p><p>–name&#x3D;c_tomcat \</p><p>-p 8080:8080 \</p><p>-v $PWD：&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps \</p><p>tomcat</p></blockquote><h3 id="Nginx-部署"><a href="#Nginx-部署" class="headerlink" title="Nginx 部署"></a>Nginx 部署</h3><ul><li>Docker hub上查找Nginx镜像</li></ul><blockquote><p>docker search nginx</p></blockquote><ul><li>从Docker Hub上(阿里云加速器)拉取Nginxl镜像到本地</li></ul><blockquote><p>docker pull nginx</p></blockquote><ul><li>创建容器,设置端口映射、目录映射</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vim">#在root目录下创建nginx目录用于存储nginx数据信息<br><span class="hljs-built_in">mkdir</span> ~/nginx<br><span class="hljs-keyword">cd</span> ~/nginx<br><span class="hljs-built_in">mkdir</span> <span class="hljs-keyword">conf</span><br><span class="hljs-keyword">cd</span> <span class="hljs-keyword">conf</span><br><span class="hljs-keyword">vim</span> nginx.<span class="hljs-keyword">conf</span> #nginx.<span class="hljs-keyword">conf</span>事先准备用于粘贴<br><span class="hljs-keyword">cd</span> ..<br></code></pre></td></tr></table></figure><blockquote><p>docker run -id \</p><p>–name&#x3D;c_nginx \</p><p>-p 80:80 \</p><p>-v $PWD&#x2F;conf&#x2F;nginx.conf:&#x2F;etc&#x2F;nginx&#x2F;nginx.conf \</p><p>-v $PWD&#x2F;logs:&#x2F;var&#x2F;log&#x2F;nginx \</p><p>-v $PWD&#x2F;html:&#x2F;usr&#x2F;sharer&#x2F;nginx&#x2F;html \</p><p>nginx</p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># This is a sample Nginx configuration for Elefant.</span><br><span class="hljs-comment"># Add these to your server&#123;&#125; block, making sure to</span><br><span class="hljs-comment"># adjust the root path and add any additional</span><br><span class="hljs-comment"># configurations you require.</span><br><br><span class="hljs-comment"># Uncomment if required</span><br><br><span class="hljs-comment">## Fast-CGI cache settings</span><br><span class="hljs-comment">#fastcgi_cache_path /tmp levels=1 keys_zone=CACHE:16m inactive=24h;</span><br><span class="hljs-comment">#fastcgi_cache_key &quot;$scheme$request_method$host$request_uri&quot;;</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#set $nocache &quot;&quot;;</span><br><span class="hljs-comment">#if ($http_cookie ~ (PHPSESSID)) &#123;</span><br><span class="hljs-comment">#        set $nocache &quot;Y&quot;;</span><br><span class="hljs-comment">#&#125;</span><br><span class="hljs-comment">## &quot;elefant_user&quot; should be replaced by value of session_name from config</span><br><span class="hljs-comment">#if ($http_cookie ~ (elefant_user)) &#123;</span><br><span class="hljs-comment">#        set $nocache &quot;Y&quot;;</span><br><span class="hljs-comment">#&#125;</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#fastcgi_cache           CACHE;</span><br><span class="hljs-comment">#fastcgi_cache_valid     200 302  1d;</span><br><span class="hljs-comment">#fastcgi_cache_valid     301      1d;</span><br><span class="hljs-comment">#fastcgi_cache_valid     any      1m;</span><br><span class="hljs-comment">#fastcgi_cache_min_uses  1;</span><br><span class="hljs-comment">#fastcgi_cache_use_stale error timeout invalid_header http_500;</span><br><span class="hljs-comment">#fastcgi_ignore_headers  Set-Cookie Expires Cache-Control;</span><br><span class="hljs-comment">#fastcgi_pass_header     Set-Cookie;</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#fastcgi_cache_bypass    $nocache;</span><br><span class="hljs-comment">#fastcgi_no_cache        $nocache;</span><br><br><span class="hljs-section">location</span><span class="hljs-regexp"> ^~</span> /conf/ &#123;<br>	<span class="hljs-attribute">deny</span> all;<br>	<span class="hljs-attribute">return</span> <span class="hljs-number">403</span>;<br>&#125;<br><span class="hljs-section">location</span> <span class="hljs-regexp">~ ^/(cache|apps|tests|lib)/.*\.(php|sql)$</span> &#123;<br>	<span class="hljs-attribute">deny</span> all;<br>	<span class="hljs-attribute">return</span> <span class="hljs-number">403</span>;<br>&#125;<br><span class="hljs-section">location</span> <span class="hljs-regexp">~ ^/files/.*\.(?!(gif|jpe?g|png|mp4|pdf))$</span> &#123;<br>	<span class="hljs-attribute">add_header</span> Content-disposition <span class="hljs-string">&quot;attachment&quot;</span>;<br>&#125;<br><span class="hljs-section">location</span> / &#123;<br>	<span class="hljs-attribute">root</span> /var/www/nginx-default;<br>	<span class="hljs-attribute">index</span> index.php;<br>	<span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.php?<span class="hljs-variable">$args</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="Redis-部署"><a href="#Redis-部署" class="headerlink" title="Redis 部署"></a>Redis 部署</h3><ul><li>Docker hub上查找redis镜像</li></ul><blockquote><p>docker search redis</p></blockquote><ul><li>从Docker Hub上(阿里云加速器)拉取redis镜像</li></ul><blockquote><p>docker pull redis:5.0</p></blockquote><ul><li>创建容器,设置端口映射</li></ul><blockquote><p>docker run -id \</p><p>–name&#x3D;c_redis \</p><p>-p 6379:6379\</p><p>redis:5.0</p></blockquote><ul><li>使用redis-cli连接</li></ul><blockquote><p>docker exec -it c_redis redis-cli</p></blockquote><ul><li>打开redis客户端连接redis服务器</li></ul><h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><h3 id="Dockerfile概念"><a href="#Dockerfile概念" class="headerlink" title="Dockerfile概念"></a>Dockerfile概念</h3><p>Dockerfile是由一系列命令和参数构成的脚本，这些命令应用于基础镜像并最终创建一个新的镜像</p><p>对于开发人员：可以为开发团队提供一个完全一致的开发环境<br>对于测试人员：可以直接拿开发时所构建的镜像或者通过Dockerfile文件构建一个新的镜像开始工作<br>对于运维人员：在部署时，可以实现应用的无缝移植</p><h3 id="Docker镜像原理"><a href="#Docker镜像原理" class="headerlink" title="Docker镜像原理"></a>Docker镜像原理</h3><p><img src="https://gcore.jsdelivr.net/gh/ChengRui79/ImageHost@main/img/202305071653680.png" srcset="/img/loading.gif" lazyload alt="image-20230507165351604"></p><img src="https://gcore.jsdelivr.net/gh/ChengRui79/ImageHost@main/img/202305071659833.png" srcset="/img/loading.gif" lazyload alt="image-20230507165959629" style="zoom:67%"><h3 id="Docker镜像制作"><a href="#Docker镜像制作" class="headerlink" title="Docker镜像制作"></a>Docker镜像制作</h3><p>1.容器转为镜像</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gauss">docker commit 容器id 镜像名称：版本号（镜像名称：版本号自定义）commit命令数据卷挂载内容消失<br>docker <span class="hljs-keyword">save</span> -o 压缩文件名称 镜像名称：版本号（压缩文件名称自定义）<span class="hljs-meta">#压缩镜像</span><br>docker <span class="hljs-keyword">load</span> -i 压缩文件名称 <span class="hljs-meta">#还原镜像</span><br></code></pre></td></tr></table></figure><p>2.Dockerfile</p><h3 id="DockerFile-常用命令"><a href="#DockerFile-常用命令" class="headerlink" title="DockerFile 常用命令"></a>DockerFile 常用命令</h3><p><img src="https://gcore.jsdelivr.net/gh/ChengRui79/ImageHost@main/img/202305071827176.png" srcset="/img/loading.gif" lazyload alt="image-20230507182746068"></p><h4 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h4><p>指明构建的新镜像是来自于哪个基础镜像，例如：</p><blockquote><p>FROM centos: latest</p></blockquote><h4 id="MAINTAINER"><a href="#MAINTAINER" class="headerlink" title="MAINTAINER"></a>MAINTAINER</h4><p>指明镜像维护者及其联系方式（一般是邮箱地址），例如：</p><blockquote><p>MAINTAINER Rui Cheng <a href="mailto:&#x63;&#x68;&#x65;&#x6e;&#103;&#114;&#x75;&#105;&#x2e;&#x73;&#107;&#x40;&#x67;&#x6d;&#x61;&#x69;&#108;&#46;&#x63;&#x6f;&#109;">&#x63;&#x68;&#x65;&#x6e;&#103;&#114;&#x75;&#105;&#x2e;&#x73;&#107;&#x40;&#x67;&#x6d;&#x61;&#x69;&#108;&#46;&#x63;&#x6f;&#109;</a></p></blockquote><p>不过，MAINTAINER并不推荐使用，更推荐使用LABEL来指定镜像作者，例如：</p><blockquote><p>LABEL maintainer&#x3D;“Rui Cheng”</p></blockquote><h4 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h4><p>拷贝文件或目录到镜像中，PS：如果是URL或压缩包，会自动下载或自动解压，例如：</p><blockquote><p>ADD …<br>ADD html.tar.gz &#x2F;var&#x2F;www&#x2F;html<br>ADD <a target="_blank" rel="noopener" href="https://xxx.com/html.tar.gz">https://xxx.com/html.tar.gz</a> &#x2F;var&#x2F;www&#x2F;html</p></blockquote><h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><p>启动容器时执行的Shell命令，例如：</p><blockquote><p>CMD [“-C”, “&#x2F;start.sh”]<br>CMD [“&#x2F;usr&#x2F;sbin&#x2F;sshd”, “-D”]<br>CMD &#x2F;usr&#x2F;sbin&#x2F;sshd -D</p></blockquote><h4 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h4><p>声明容器运行的服务端口，例如：</p><blockquote><p>EXPOSE 80 443</p></blockquote><h4 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h4><p>拷贝文件或目录到镜像中，用法同ADD，只是不支持自动下载和解压，例如：</p><blockquote><p>COPY .&#x2F;start.sh &#x2F;start.sh</p></blockquote><h4 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h4><p>设置环境内环境变量，例如：</p><blockquote><p>ENV MYSQL_ROOT_PASSWORD 123456<br>ENV JAVA_HOME &#x2F;usr&#x2F;local&#x2F;jdk1.8.0_45</p></blockquote><h4 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h4><p>指定容器挂载点到宿主机自动生成的目录或其他容器，例如：</p><blockquote><p>VOLUME [“&#x2F;var&#x2F;lib&#x2F;mysql”]<br>PS：一般不会在Dockerfile中用到，更常见的还是在docker run的时候指定-v数据卷。</p></blockquote><h4 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h4><p>为RUN、CMD、ENTRYPOINT以及COPY和AND设置工作目录，例如：</p><blockquote><p>WORKDIR &#x2F;data</p></blockquote><h3 id="使用脚本创建镜像"><a href="#使用脚本创建镜像" class="headerlink" title="使用脚本创建镜像"></a>使用脚本创建镜像</h3><ul><li>准备编写DockerFile文件<br>vim Dockerfile</li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> centos:latest<br><span class="hljs-keyword">MAINTAINER</span> zRuiCheng &lt;chengrui.sk@gmail.com&gt;<br><span class="hljs-keyword">ENV</span> MYPATH /usr/local<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> <span class="hljs-variable">$MYPATH</span></span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> yum -y install vim</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> yum -y install net-tools</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">80</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$MYPATH</span></span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;success--------------ok&quot;</span></span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> /bin/bash</span><br></code></pre></td></tr></table></figure><ul><li>构建镜像</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> build -f DockerFile文件路径 -t mycentos:<span class="hljs-number">1</span>.<span class="hljs-number">1</span> .<br></code></pre></td></tr></table></figure><ul><li>运行镜像创建容器</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run -id -p <span class="hljs-number">9000</span>:<span class="hljs-number">8000</span> mycentos:<span class="hljs-number">1</span>.<span class="hljs-number">1</span>（name可默认,端口映射方便外部访问）<br></code></pre></td></tr></table></figure><h2 id="Docker-Compose服务编排"><a href="#Docker-Compose服务编排" class="headerlink" title="Docker Compose服务编排"></a>Docker Compose服务编排</h2><p><img src="https://gcore.jsdelivr.net/gh/ChengRui79/ImageHost@main/img/202305071918200.png" srcset="/img/loading.gif" lazyload alt="image-20230507191809069"></p><h3 id="docker-compose安装"><a href="#docker-compose安装" class="headerlink" title="docker-compose安装"></a>docker-compose安装</h3><p><strong>docker-compose是docker的独立产品，因此需要安装docker之后再单独安装docker compose</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">curl -L https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/docker/</span>compose<span class="hljs-regexp">/releases/</span>download<span class="hljs-regexp">/1.21.1/</span>docker-compose-`uname -s`-`uname -m` -o <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/</span>docker-compose<br><span class="hljs-comment">#下载docker-compose文件</span><br>mv docker-compose <span class="hljs-regexp">/usr/</span>local/bin<br><span class="hljs-comment">#将文件复制到/usr/local/bin环境变量下面</span><br>chmod +x <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/</span>docker-compose<br><span class="hljs-comment">#给他一个执行权限</span><br></code></pre></td></tr></table></figure><h3 id="docker-compose卸载"><a href="#docker-compose卸载" class="headerlink" title="docker-compose卸载"></a>docker-compose卸载</h3><p>在 Docker 中，当我们执行 docker pull xxx 的时候 ，它实际上是从 registry.hub.docker.com这个地址去查找，这就是Docker公司为我们提供的公共仓库。<br>在工作中，不可能把企业项目push到公有仓库进行管理。为了更好的管理镜像，Docker不仅提供了一个中央仓库，同时允许搭建本地私有仓库。介绍registry、harbor两种私有仓库搭建。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">rm <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/</span>docker-compose<br></code></pre></td></tr></table></figure><h2 id="Docker私有仓库"><a href="#Docker私有仓库" class="headerlink" title="Docker私有仓库"></a>Docker私有仓库</h2><h3 id="搭建私有仓库"><a href="#搭建私有仓库" class="headerlink" title="搭建私有仓库"></a>搭建私有仓库</h3><ul><li>Docker 官方提供了一个搭建私有仓库的镜像 registry ，只需把镜像下载下来，运行容器并暴<br>露5000端口，就可以使用了。</li></ul><blockquote><p>docker pull registry:2</p></blockquote><blockquote><p>docker run -id -v &#x2F;opt&#x2F;registry:&#x2F;var&#x2F;lib&#x2F;registry -p 5000:5000 –name&#x3D;myregistry registry:2</p></blockquote><p>Registry服务默认会将上传的镜像保存在容器的&#x2F;var&#x2F;lib&#x2F;registry，将主机的&#x2F;opt&#x2F;registry目录挂载<br>到该目录，即可实现将镜像保存到主机的&#x2F;opt&#x2F;registry目录了。</p><ul><li>浏览器访问http:&#x2F;&#x2F;私有服务器ip：5000&#x2F;v2&#x2F;__catalog，出现json说明registry运行正常</li></ul><h3 id="将本地镜像上传至私有仓库"><a href="#将本地镜像上传至私有仓库" class="headerlink" title="将本地镜像上传至私有仓库"></a>将本地镜像上传至私有仓库</h3><ul><li>要通过docker tag将该镜像标志为要推送到私有仓库：</li></ul><blockquote><p>docker tag nginx:latest 私有服务器ip:5000&#x2F;nginx:latest</p></blockquote><ul><li>通过 docker push 命令将 nginx 镜像 push到私有仓库中：</li></ul><blockquote><p>docker push 私有服务器ip:5000&#x2F;nginx:latest</p></blockquote><ul><li>访问 http:&#x2F;&#x2F;:私有服务器ip:5000&#x2F;v2&#x2F;_catalog 查看私有仓库目录，可以看到刚上传的镜像了：</li></ul><blockquote><p>http:&#x2F;&#x2F;:私有服务器ip:5000&#x2F;v2&#x2F;_catalog</p></blockquote><h3 id="从私有仓库拉取镜像"><a href="#从私有仓库拉取镜像" class="headerlink" title="从私有仓库拉取镜像"></a>从私有仓库拉取镜像</h3><ul><li>下载私有仓库的镜像，使用如下命令：</li></ul><blockquote><p>docker pull 私有服务器ip:5000&#x2F;镜像名:版本号<br>docker pull 私有服务器ip:5000&#x2F;nginx:latest</p></blockquote><h2 id="Docker与虚拟机对比"><a href="#Docker与虚拟机对比" class="headerlink" title="Docker与虚拟机对比"></a>Docker与虚拟机对比</h2><p><img src="https://gcore.jsdelivr.net/gh/ChengRui79/ImageHost@main/img/202305072022189.png" srcset="/img/loading.gif" lazyload alt="image-20230507202214980"></p><hr><p><code>相关项目实践即docker与宝塔/青龙的综合运用待后续补充</code></p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/AT/" class="category-chain-item">AT</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/docker/">#docker</a> <a href="/tags/AT/">#AT</a></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2023/05/29/Anti-tampering%20of%20dynamic%20web%20pages(%E5%8A%A8%E6%80%81%E7%BD%91%E9%A1%B5%E9%98%B2%E7%AF%A1%E6%94%B9%EF%BC%89/" title="Anti-tampering of dynamic web pages(动态网页防篡改）"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Anti-tampering of dynamic web pages(动态网页防篡改）</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2023/04/22/Test%20paper%20distribution%20system/" title="system"><span class="hidden-mobile">system</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="valine"></div><script type="text/javascript">Fluid.utils.loadComments("#valine",function(){Fluid.utils.createScript("https://lib.baomitu.com/valine/1.5.1/Valine.min.js",function(){var e=Object.assign({appId:"NZzmWHo4vLeDsTh3MaGJBfT1-gzGzoHsz",appKey:"EaF7VkHeBkgVwTLy7IHYmPIs",path:"window.location.pathname",placeholder:"留下你的评论吧",avatar:"retro",meta:["nick","mail","link"],requiredFields:[],pageSize:5,lang:"zh-CN",highlight:!1,recordIP:!1,serverURLs:"https://nzzmwho4.lc-cn-n1-shared.com",emojiCDN:"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/",emojiMaps:null,enableQQ:!1,enable:!0},{el:"#valine",path:window.location.pathname});new Valine(e),Fluid.utils.waitElementVisible("#valine .vcontent",()=>{var e="#valine .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(e),Fluid.plugins.fancyBox(e)})})})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a><div style="font-size:.85rem"><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script src="/js/duration.js"></script></div><div id="music_div" style="position:fixed;bottom:0;left:30px"><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="110" src="//music.163.com/outchain/player?type=0&id=919444742&auto=1&height=90"></iframe><script src="https://cdn.staticfile.org/jquery/3.3.1/jquery.min.js"></script><script src="/js/musicshow.js"></script></div></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">本Blog总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访客数 <span id="leancloud-site-uv"></span> 人</span></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">苏ICP备2023020951号-1</a></span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,t=t.getElementById("subtitle");t&&e&&e(t.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){var t;"tocbot"in window&&(tocbot.refresh(),0!==(t=jQuery("#toc")).length)&&tocbot&&0<t.find(".toc-list-item").length&&t.css("visibility","visible")}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback(function(){if("anchors"in window){anchors.removeAll();var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}})})</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script defer src="/js/leancloud.js"></script><script src="/js/local-search.js"></script><script src="/js/yinghua.js"></script><script src="/js/love.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript><script src="https://cdn.jsdelivr.net/npm/bluebird@3/js/browser/bluebird.min.js"></script><script src="https://cdn.jsdelivr.net/npm/whatwg-fetch@2.0.3/fetch.min.js"></script><script>fetch("https://v1.hitokoto.cn").then(function(t){return t.json()}).then(function(t){document.getElementById("hitokoto").innerText=t.hitokoto+"——【"+t.from+"】"}).catch(function(t){console.error(t)})</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({model:{jsonPath:"/live2dw/assets/shizuku.model.json"},display:{position:"right",width:150,height:300},mobile:{show:!0},log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/",tagMode:!1})</script></body></html>